# 中断





## 系统调用 (system call)

**应用程序主动向操作系统发出的服务请求**

- 特权级的切换和堆栈的切换
- 开销超过函数调用
- 开销:
  - 切换内核堆栈
  - 验证参数
  - 可能切换页表
  - 需要拷贝 



## 异常 (exception)

**非法指令或其他原因导致当前指令执行失败后的处理请求**

- 一般是用来解决bug
- 惩罚应用程序, 保存现场 



## 中断 (hardware interrpt)

**来自硬件设备的处理请求**





## 中断解决了什么问题

- 类似于服务端主动推送, 如果没有中断, 要想保证系统运行正常, 就需要cpu不断地去轮训各个io设备 (开销很大)
- 提高了交互效率



## 异步/同步

- 中断是异步的, 异常是同步的, 系统调用是异步或者同步





## 硬件架构支持





## 3种标准中断源

- 软件中断通过向内存映射寄存器触发
- 时钟中断
- 平台级控制器触发



## 建立中断机制

- 建立中断服务例程
- 
- 



#### 让cpu能响应中断

- 设置特定寄存 器
- 该中断源没有被屏蔽
- 中断请求优先级最高

- 保存/恢复现场



## 中断向量表



## 

## 中断控制器





## 中断链表技术 (interrupt chainning)

**一般来说, 计算机设备比向量内的地址多.**

**中断向量表中每个元素都指向一个链表头, 当有中断发生时, 链表上每个程序都一次执行, 直到找到可以处理的程序为止.**



## 中断优先级 (priority)

**优先处理高优先级中断, 延迟处理低优先级中断而不屏蔽所有中断**







## 用处

**1. 使用中断机制进行虚拟内存分页**



**2. 使用软中断实现系统调用**



**3. 管理内核的控制流**



